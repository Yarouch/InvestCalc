<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Hypoteƒçn√≠ vs. investiƒçn√≠ kalkulaƒçka</title>
  <style>
    :root{
      /* Tmav√© t√©ma (v√Ωchoz√≠) */
      --bg: linear-gradient(180deg, #080A0E 0%, #0B0C10 40%, #0E1014 100%);
      --panel:#12141a; --muted:#9aa3b2; --text:#e6e9ef; --brand:#4f8cff; --accent:#79e6a1;
      --principal:#4f6dff; --interest:#00cc66; --grid: rgba(255,255,255,.08);
      --radius:14px; --ring:0 0 0 3px rgba(79,140,255,.25);
      color-scheme: light dark;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg: linear-gradient(180deg,#fff 0%,#f6f8fb 60%,#eef3f9 100%);
        --panel:#ffffff; --muted:#667085; --text:#0b0c10; --brand:#375dfb; --accent:#00b36b; --grid: rgba(0,0,0,.08);
      }
    }

    *{box-sizing:border-box}
    body{
      margin:0; font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial; color:var(--text); background:var(--bg);
      min-height:100svh; padding-bottom:env(safe-area-inset-bottom)
    }

    /* Horn√≠ navigace (sjednocen√° s ostatn√≠mi) */
    .topnav{
      position:sticky; top:0; z-index:100; background:rgba(18,20,26,.8); border-bottom:1px solid rgba(255,255,255,.06);
      padding-top:max(10px, env(safe-area-inset-top)); backdrop-filter:blur(6px)
    }
    .topnav .inner{max-width:1100px; margin:0 auto; padding:10px 20px; display:flex; gap:12px; align-items:center}
    .topnav a{display:inline-block; padding:10px 12px; border-radius:12px; text-decoration:none; color:#fff; border:1px solid transparent; font-weight:600;}
    .topnav a.active{ background:linear-gradient(135deg,var(--brand),#6aa8ff); color:#fff; box-shadow:0 8px 20px rgba(79,140,255,.35) }
    @media (prefers-color-scheme: light){
      .topnav{ background:rgba(255,255,255,.75); border-bottom:1px solid rgba(0,0,0,.06) }
      .topnav a{ color:#0b0c10 }
      .topnav a.active{ color:#fff }
    }

    .wrap{ max-width:1100px; margin:min(6vh,48px) auto; padding:20px;
      padding-left:max(20px,env(safe-area-inset-left)); padding-right:max(20px,env(safe-area-inset-right));
    }
    header{margin-bottom:18px}
    h1{font-size:clamp(22px, 3.5vw, 32px); line-height:1.2; margin:0 0 6px}
    .lead{color:var(--muted); margin:0}

    /* Dvousloupec jako index/renta */
    .grid{ display:grid; grid-template-columns: 400px 1fr; gap:22px; align-items:start }
    @media (max-width: 900px){ .grid{ grid-template-columns: 1fr } }

    .card{
      border:1px solid rgba(255,255,255,.08); border-radius:var(--radius);
      background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,0)); box-shadow:0 10px 30px rgba(0,0,0,.35)
    }
    .card .head{ padding:16px 16px 8px; border-bottom:1px solid rgba(255,255,255,.06) }
    .card .body{ padding:16px }
    @media (prefers-color-scheme: light){ .card .head{border-bottom-color:rgba(0,0,0,.06)} }

    /* Form prvky (sjednocen√©) */
    form{ display:grid; gap:12px }
    .field label{ display:block; font-weight:700; margin:0 0 6px; color:var(--text) }
    .input{
      display:flex; align-items:center; gap:8px; padding:10px 12px; border-radius:12px;
      border:1px solid rgba(255,255,255,.10); background:rgba(0,0,0,.12)
    }
    .input:focus-within{ box-shadow:var(--ring); border-color:rgba(79,140,255,.3) }
    .input span{ opacity:.85; color:var(--text) }
    input{
      appearance:none; border:0; outline:0; background:transparent; width:100%; color:var(--text); font:inherit
    }
    input::placeholder{ color:rgba(255,255,255,.65) }
    @media (prefers-color-scheme: light){ input::placeholder{ color:rgba(0,0,0,.55)} }
    :where(a,button,input):focus-visible{ outline:none; box-shadow:var(--ring) }

    .actions{ display:flex; gap:8px; flex-wrap:wrap; margin-top:4px }
    .btn{ border-radius:12px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:var(--text); font-weight:700; padding:10px 14px; cursor:pointer }
    .btn.primary{ background:linear-gradient(135deg,var(--brand),#6aa8ff); border-color:transparent; color:#fff; box-shadow:0 8px 20px rgba(79,140,255,.35) }
    .btn.ghost{ background:transparent }

    /* KPI + grafy vpravo */
    .kpis{ display:grid; grid-template-columns: repeat(3,1fr); gap:12px; margin-top:10px }
    @media (max-width: 640px){ .kpis{ grid-template-columns:1fr } }
    .kpi{ padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,0)); }
    .kpi .title{ color:var(--muted); font-size:13px; font-weight:700; letter-spacing:.02em; text-transform:uppercase }
    .kpi .value{ font-size:clamp(18px,3.5vw,26px); font-weight:900; color:var(--text); }

    .chart{ padding:14px }
    .chart-inner{ position:relative; width:100%; aspect-ratio: 16 / 9 }
    canvas{ width:100%; height:100%; display:block; background:transparent }
    .legend{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; color:var(--muted) }

    footer.note{ color:var(--muted); font-size:14px; margin-top:8px }

    /* ƒå√≠sla bez koleƒçek u number (kdyby nƒõkde z≈Østalo) */
    input[type=number] { -moz-appearance: textfield; }
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  </style>
</head>
<body>
  <nav class="topnav">
    <div class="inner">
      <a href="index.html" id="nav-uroceni">Slo≈æen√© √∫roƒçen√≠</a>
      <a href="renta.html" id="nav-renta">Finanƒçn√≠ nez√°vislost</a>
      <a href="kouzlo.html" id="nav-kouzlo">Kouzlo slo≈æen√©ho √∫roƒçen√≠</a>
      <a class="active" href="HypoInvKalk_v2.html" id="nav-hypo">Hypot√©ka vs. investice</a>
    </div>
  </nav>

  <div class="wrap">
    <header>
      <h1>Hypot√©ka vs. investice</h1>
      <p class="lead">Porovnej v√Ωvoj <strong>z≈Østatku hypot√©ky</strong> a <strong>hodnoty investice</strong>. √ölo≈æka do investice se uplat≈àuje <strong>na konci mƒõs√≠ce</strong>.</p>
    </header>

    <div class="grid">
      <!-- LEV√ù SLOUPEC ‚Äì Vstupy -->
      <section class="card" aria-labelledby="formHeading">
        <div class="head"><h2 id="formHeading">Vstupy</h2></div>
        <div class="body">
          <form id="calcForm" autocomplete="off">
            <h3 class="mini" style="margin:0 0 6px;color:var(--muted);text-transform:uppercase;letter-spacing:.02em">Hypot√©ka</h3>
            <div class="field">
              <label for="loan">V√Ω≈°e hypot√©ky (Kƒç)</label>
              <div class="input"><span>üè¶</span>
                <input id="loan" type="text" inputmode="numeric" enterkeyhint="done" value="7 000 000" spellcheck="false" />
              </div>
            </div>
            <div class="field">
              <label for="loanRate">√örok hypot√©ky (% p.a.) <span style="color:var(--muted);font-weight:400">(‚Üë/‚Üì = ¬±0,25 p. b., Shift = ¬±1)</span></label>
              <div class="input"><span>üìâ</span>
                <input id="loanRate" type="text" inputmode="decimal" enterkeyhint="done" value="5,49" spellcheck="false" />
              </div>
            </div>
            <div class="field">
              <label for="loanYears">Doba spl√°cen√≠ (roky)</label>
              <div class="input"><span>‚è≥</span>
                <input id="loanYears" type="text" inputmode="numeric" enterkeyhint="done" value="30" spellcheck="false" />
              </div>
            </div>

            <h3 class="mini" style="margin:10px 0 6px;color:var(--muted);text-transform:uppercase;letter-spacing:.02em">Investice</h3>
            <div class="field">
              <label for="lump">Jednor√°zov√° investice (Kƒç)</label>
              <div class="input"><span>üí∞</span>
                <input id="lump" type="text" inputmode="numeric" enterkeyhint="done" value="500 000" spellcheck="false" />
              </div>
            </div>
            <div class="field">
              <label for="monthly">Mƒõs√≠ƒçn√≠ √∫lo≈æka (Kƒç)</label>
              <div class="input"><span>üì•</span>
                <input id="monthly" type="text" inputmode="numeric" enterkeyhint="done" value="7 000" spellcheck="false" />
              </div>
            </div>
            <div class="field">
              <label for="invRate">Roƒçn√≠ zhodnocen√≠ investice (% p.a.) <span style="color:var(--muted);font-weight:400">(‚Üë/‚Üì = ¬±0,25 p. b., Shift = ¬±1)</span></label>
              <div class="input"><span>üìà</span>
                <input id="invRate" type="text" inputmode="decimal" enterkeyhint="done" value="9,00" spellcheck="false" />
              </div>
            </div>

            <div class="actions">
              <button class="btn primary" type="submit">P≈ôepoƒç√≠tat</button>
              <button class="btn" type="button" id="resetBtn">Vyƒçistit</button>
              <button class="btn ghost" type="button" id="shareBtn">Sd√≠let</button>
            </div>
          </form>
        </div>
      </section>

      <!-- PRAV√ù SLOUPEC ‚Äì Grafy + KPI -->
      <section class="card" aria-labelledby="chartHeading">
        <div class="head">
          <h2 id="chartHeading">V√Ωvoj v ƒçase</h2>
          <div class="legend">
            <span style="width:12px;height:12px;border-radius:3px;background:var(--brand);display:inline-block"></span> Z≈Østatek hypot√©ky
            <span style="width:12px;height:12px;border-radius:3px;background:var(--accent);display:inline-block"></span> Hodnota investice
          </div>
        </div>
        <div class="body chart">
          <div class="chart-inner" aria-label="Graf porovn√°n√≠ z≈Østatku hypot√©ky a hodnoty investice" aria-describedby="graphDesc">
            <canvas id="combinedChart"></canvas>
          </div>
          <p id="graphDesc" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden">
            Modr√° k≈ôivka zobrazuje z≈Østatek hypot√©ky, zelen√° k≈ôivka hodnotu investice.
          </p>

          <div class="kpis" id="kpis" aria-live="polite" aria-atomic="true">
            <div class="kpi">
              <div class="title">Mƒõs√≠ƒçn√≠ spl√°tka hypo</div>
              <div class="value" id="kpiPayment">‚Äì</div>
            </div>
            <div class="kpi">
              <div class="title">Celkem zaplaceno (hypo)</div>
              <div class="value" id="kpiLoanTotal">‚Äì</div>
            </div>
            <div class="kpi">
              <div class="title">Budouc√≠ hodnota investice</div>
              <div class="value" id="kpiInvFV">‚Äì</div>
            </div>
          </div>

          <div class="chart-inner" style="margin-top:14px" aria-label="Rozklad investice na vklady a zhodnocen√≠">
            <canvas id="investBreakdownChart"></canvas>
          </div>

          <footer class="note">Investice poƒç√≠t√° mƒõs√≠ƒçn√≠ kapitalizaci a √∫lo≈æku <strong>na konci mƒõs√≠ce</strong>. V√Ωsledky jsou orientaƒçn√≠ ‚Äì nezohled≈àuj√≠ inflaci, danƒõ ani poplatky.</footer>
        </div>
      </section>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    /* ======= utils ======= */
    const $ = (id)=> document.getElementById(id);
    const fmtCZK0 = new Intl.NumberFormat('cs-CZ', { style:'currency', currency:'CZK', maximumFractionDigits:0 });

    function parseNum(v){
      return Number(String(v).replace(/[\s\u00A0\u202F]/g,'').replace(/\.(?=\d{3}(\D|$))/g,'').replace(',', '.')) || 0;
    }
    function formatInput(el, dec=0){
      el.value = String(el.value ?? '').replace(/[\s\u00A0\u202F]/g,'').replace(',', '.');
      const n = Number(el.value)||0;
      const out = dec ? n.toFixed(dec) : Math.round(n).toString();
      el.value = out.replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g,' ');
    }
    function getVar(name){ return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }
    function debounce(fn, ms=100){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; }

    // Deep-link
    function readParams(defaults){
      const p = new URLSearchParams(location.search); const out={...defaults};
      for (const k of Object.keys(defaults)){
        if (!p.has(k)) continue;
        const raw = p.get(k);
        out[k] = typeof defaults[k] === 'number' ? parseNum(raw) : raw;
      }
      return out;
    }
    function writeParams(obj){
      const p = new URLSearchParams();
      for (const [k,v] of Object.entries(obj)) p.set(k, String(v));
      history.replaceState(null, '', '?'+p.toString());
    }

    /* ======= finance (mƒõs√≠ƒçn√≠ krok) ======= */
    // anuitn√≠ spl√°tka (mƒõs√≠ƒçn√≠)
    function annuityPayment(P, rAnnualPct, years){
      const n = Math.max(1, Math.round(years*12));
      const r = (Number(rAnnualPct)||0)/100/12;
      if (r === 0) return P / n;
      return P * r / (1 - Math.pow(1+r, -n));
    }

    // amortizaƒçn√≠ s√©rie z≈Østatk≈Ø (vƒçetnƒõ prvn√≠ho bodu 0 = P)
    function loanBalances(P, rAnnualPct, years){
      const n = Math.max(1, Math.round(years*12));
      const r = (Number(rAnnualPct)||0)/100/12;
      const A = annuityPayment(P, rAnnualPct, years);
      const series = new Array(n+1);
      let bal = P; series[0]=bal;
      for(let m=1;m<=n;m++){
        bal = bal*(1+r) - A;
        if (bal < 0) bal = 0;
        series[m]=bal;
      }
      return { series, payment:A, months:n };
    }

    // investiƒçn√≠ s√©rie (konec mƒõs√≠ce: √∫rok -> vklad)
    function investmentSeries(P0, PMT, rAnnualPct, years){
      const n = Math.max(0, Math.round(years*12));
      const r = (Number(rAnnualPct)||0)/100/12;
      const total = new Array(n+1), deposits = new Array(n+1);
      let bal=P0, contrib=P0;
      total[0]=bal; deposits[0]=contrib;
      for(let m=1;m<=n;m++){
        bal *= (1+r);      // √∫rok
        bal += PMT;        // vklad na konci mƒõs√≠ce
        contrib += PMT;
        total[m]=bal; deposits[m]=contrib;
      }
      return { total, deposits, months:n };
    }

    /* ======= grafy ‚Äì jednor√°zov√° inicializace ======= */
    const baseOptions = {
      responsive:true, maintainAspectRatio:false, animation:false,
      interaction:{ mode:'nearest', intersect:false },
      plugins:{
        legend:{ labels:{ color: getVar('--text') }},
        tooltip:{ callbacks:{ label:(c)=> {
          const v = Math.round(c.parsed.y||0).toLocaleString('cs-CZ');
          return `${c.dataset.label}: ${v} Kƒç`;
        }}}
      },
      scales:{
        x:{ ticks:{ color:getVar('--text') }, grid:{ color:'transparent' }},
        y:{ ticks:{ color:getVar('--text'), callback:v=>v.toLocaleString('cs-CZ') }, grid:{ color:getVar('--grid') } }
      }
    };

    const combinedChart = new Chart($('combinedChart').getContext('2d'), {
      type:'line',
      data:{ labels:[], datasets:[
        {label:'Z≈Østatek hypot√©ky', data:[], borderColor:getVar('--brand'), pointBackgroundColor:getVar('--brand'), borderWidth:2, tension:.2},
        {label:'Hodnota investice', data:[], borderColor:getVar('--accent'), pointBackgroundColor:getVar('--accent'), borderWidth:2, tension:.2}
      ]},
      options: baseOptions
    });

    const investBreakdownChart = new Chart($('investBreakdownChart').getContext('2d'), {
      type:'line',
      data:{ labels:[], datasets:[
        {label:'Vlo≈æen√© prost≈ôedky', data:[], borderWidth:1.5, tension:.2, fill:true, stack:'invest',
         backgroundColor:'rgba(121,230,161,0.18)', borderColor:'rgba(121,230,161,0.95)'},
        {label:'Zhodnocen√≠', data:[], borderWidth:1.5, tension:.2, fill:true, stack:'invest',
         backgroundColor:'rgba(108,163,255,0.18)', borderColor:'rgba(108,163,255,0.95)'}
      ]},
      options: {
        ...baseOptions,
        scales:{
          x:{ ...baseOptions.scales.x, stacked:true },
          y:{ ...baseOptions.scales.y, stacked:true }
        }
      }
    });

    function renderCombined(labels, loanSeries, invSeries){
      combinedChart.data.labels = labels;
      combinedChart.data.datasets[0].data = loanSeries;
      combinedChart.data.datasets[1].data = invSeries;
      combinedChart.update('none');
    }
    function renderBreakdown(labels, deposits, gains){
      investBreakdownChart.data.labels = labels;
      investBreakdownChart.data.datasets[0].data = deposits;
      investBreakdownChart.data.datasets[1].data = gains;
      investBreakdownChart.update('none');
    }

    /* ======= str√°nka ======= */
    const els = {
      loan: $('loan'), loanRate: $('loanRate'), loanYears: $('loanYears'),
      lump: $('lump'), monthly: $('monthly'), invRate: $('invRate'),
      form: $('calcForm'), reset: $('resetBtn'), share: $('shareBtn'),
      kpiPayment: $('kpiPayment'), kpiLoanTotal: $('kpiLoanTotal'), kpiInvFV: $('kpiInvFV'),
    };

    /* --- univerz√°ln√≠ ‚Äûklikni-a-p≈ôepi≈°‚Äú --- */
    function enableSelectAll(el){
      el.addEventListener('focus', ()=>{ el.select(); el.dataset.selAll='1'; });
      el.addEventListener('mouseup', (e)=>{ if (el.dataset.selAll){ e.preventDefault(); delete el.dataset.selAll; } });
    }
    [els.loan, els.loanYears, els.lump, els.monthly].forEach(enableSelectAll);

    /* --- speci√°ln√≠ UX pro sazby (% p.a.) --- */
    enableSelectAll(els.loanRate);
    enableSelectAll(els.invRate);

    const clampPct = (v)=> Math.max(-100, Math.min(100, v));
    const getLoanRate = ()=> parseNum(els.loanRate.value);
    const setLoanRate = (v)=>{ els.loanRate.value = (Number(v)||0).toFixed(2).replace('.',','); };
    const stepLoanRate = (d)=>{ setLoanRate(clampPct(getLoanRate()+d)); update(); };

    const getInvRate = ()=> parseNum(els.invRate.value);
    const setInvRate = (v)=>{ els.invRate.value = (Number(v)||0).toFixed(2).replace('.',','); };
    const stepInvRate = (d)=>{ setInvRate(clampPct(getInvRate()+d)); update(); };

    function update(opts={ formatRates:true }){
      // form√°tov√°n√≠ vstup≈Ø (sazby jen pokud chceme ‚Äì ne p≈ôi psan√≠)
      formatInput(els.loan,0);
      if (opts.formatRates) formatInput(els.loanRate,2);
      formatInput(els.loanYears,0);
      formatInput(els.lump,0);
      formatInput(els.monthly,0);
      if (opts.formatRates) formatInput(els.invRate,2);

      const loan = parseNum(els.loan.value);
      const loanRate = parseNum(els.loanRate.value);
      const loanYears = Math.max(1, parseNum(els.loanYears.value));

      const lump = parseNum(els.lump.value);
      const monthly = parseNum(els.monthly.value);
      const invRate = parseNum(els.invRate.value);

      // Deep-link do URL
      writeParams({ loan, loanRate, loanYears, lump, monthly, invRate });

      // V√Ωpoƒçty
      const { series: loanSer, payment: A, months:n } = loanBalances(loan, loanRate, loanYears);
      const { total: invSer, deposits } = investmentSeries(lump, monthly, invRate, loanYears);
      const gains = invSer.map((v,i)=> Math.max(0, v - deposits[i]));

      // Roƒçn√≠ sampling (0..n po 12 mƒõs√≠c√≠ch)
      const labels=[], loanY=[], invY=[], depY=[], gainY=[];
      for(let m=0;m<=n;m+=12){ labels.push(`${Math.round(m/12)}. rok`); loanY.push(loanSer[m]); invY.push(invSer[m]); depY.push(deposits[m]); gainY.push(gains[m]); }
      if (n%12!==0){ labels.push(`${(n/12).toFixed(1)}. rok`); loanY.push(loanSer[n]); invY.push(invSer[n]); depY.push(deposits[n]); gainY.push(gains[n]); }

      // KPI
      const loanTotalPaid = Math.round(A*n);
      const invFV = invSer[invSer.length-1];

      els.kpiPayment.textContent = fmtCZK0.format(A);
      els.kpiLoanTotal.textContent = fmtCZK0.format(loanTotalPaid);
      els.kpiInvFV.textContent = fmtCZK0.format(invFV);

      // Grafy
      renderCombined(labels, loanY, invY);
      renderBreakdown(labels, depY, gainY);
    }

    const updateDebounced = debounce(update, 80);

    // Inicializace z URL
    (function initFromURL(){
      const p = readParams({
        loan: 7000000, loanRate: 5.49, loanYears: 30,
        lump: 500000, monthly: 7000, invRate: 9
      });
      els.loan.value = p.loan.toLocaleString('cs-CZ');
      els.loanRate.value = p.loanRate.toFixed(2).replace('.',',');
      els.loanYears.value = p.loanYears.toLocaleString('cs-CZ');
      els.lump.value = p.lump.toLocaleString('cs-CZ');
      els.monthly.value = p.monthly.toLocaleString('cs-CZ');
      els.invRate.value = p.invRate.toFixed(2).replace('.',',');
    })();

    // Handlery ‚Äì ostatn√≠ pole: standardn√≠ live p≈ôepoƒçet
    els.form.addEventListener('submit', e=>{ e.preventDefault(); update(); });
    ['input','change','blur'].forEach(evt=>{
      [els.loan, els.loanYears, els.lump, els.monthly]
        .forEach(el=> el.addEventListener(evt, updateDebounced, {passive:true}));
    });

    // Sazby ‚Äì p≈ôi psan√≠ neform√°tovat, doform√°tovat a≈æ na blur, krokov√°n√≠ ≈°ipkami a koleƒçkem
    els.loanRate.addEventListener('input', ()=> update({ formatRates:false }));
    els.invRate.addEventListener('input',  ()=> update({ formatRates:false }));

    els.loanRate.addEventListener('blur', ()=>{ setLoanRate(getLoanRate()); update(); });
    els.invRate.addEventListener('blur',  ()=>{ setInvRate(getInvRate());   update(); });

    els.loanRate.addEventListener('keydown', (e)=>{
      if (e.key === 'ArrowUp')   { e.preventDefault(); stepLoanRate(e.shiftKey ? 1 : 0.25); }
      if (e.key === 'ArrowDown') { e.preventDefault(); stepLoanRate(e.shiftKey ? -1 : -0.25); }
    });
    els.invRate.addEventListener('keydown', (e)=>{
      if (e.key === 'ArrowUp')   { e.preventDefault(); stepInvRate(e.shiftKey ? 1 : 0.25); }
      if (e.key === 'ArrowDown') { e.preventDefault(); stepInvRate(e.shiftKey ? -1 : -0.25); }
    });

    els.loanRate.addEventListener('wheel', (e)=>{
      if (document.activeElement === els.loanRate){
        e.preventDefault();
        stepLoanRate(e.deltaY < 0 ? (e.shiftKey ? 1 : 0.25) : (e.shiftKey ? -1 : -0.25));
      }
    }, { passive:false });
    els.invRate.addEventListener('wheel', (e)=>{
      if (document.activeElement === els.invRate){
        e.preventDefault();
        stepInvRate(e.deltaY < 0 ? (e.shiftKey ? 1 : 0.25) : (e.shiftKey ? -1 : -0.25));
      }
    }, { passive:false });

    // Reset & Sd√≠len√≠
    $('resetBtn').addEventListener('click', ()=>{
      els.loan.value='7 000 000'; els.loanRate.value='5,49'; els.loanYears.value='30';
      els.lump.value='500 000'; els.monthly.value='7 000'; els.invRate.value='9,00';
      update();
    });
    $('shareBtn').addEventListener('click', async ()=>{
      const url = location.href;
      if (navigator.share){
        try { await navigator.share({title:document.title, url}); } catch(_) {}
      } else {
        try { await navigator.clipboard.writeText(url); alert('Odkaz zkop√≠rov√°n do schr√°nky.'); }
        catch { prompt('Zkop√≠ruj odkaz:', url); }
      }
    });

    // Prvn√≠ v√Ωpoƒçet + resize
    update();
    window.addEventListener('resize', updateDebounced, {passive:true});
  </script>
</body>
</html>
